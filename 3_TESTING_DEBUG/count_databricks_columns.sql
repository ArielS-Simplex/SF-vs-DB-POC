-- Count columns in Databricks silver table
-- Extract from databricks_silver_data_sample header line

-- Expected Databricks Silver Columns (from sample):
-- This is what we need to match exactly

WITH databricks_columns AS (
  SELECT SPLIT('transaction_main_id	transaction_date	transaction_id_life_cycle	transaction_date_life_cycle	transaction_type_id	transaction_type	transaction_result_id	final_transaction_status	multi_client_id	client_id	multi_client_name	client_name	3d_flow_status	challenge_preference	preference_reason	authentication_flow	3d_flow	is_void	liability_shift	status	acs_url	acs_res_authentication_status	r_req_authentication_status	transaction_status_reason	interaction_counter	challenge_cancel	three_ds_method_indication	is_sale_3d	manage_3d_decision	decline_reason	amount_in_usd	approved_amount_in_usd	original_currency_amount	rate_usd	currency_code	three_ds_protocol_version	is_external_mpi	rebill	device_channel	user_agent_3d	device_type	device_name	device_os	challenge_window_size	type_of_authentication_method	industry_code	credit_card_id	cccid	bin	is_prepaid	card_scheme	card_type	consumer_id	issuer_bank_name	device_channel_name	bin_country	is_eea	region	payment_instrument	source_application	is_partial_amount	enable_partial_approval	partial_approval_is_void	partial_approval_void_id	partial_approval_void_time	partial_approval_requested_amount	partial_approval_requested_currency	partial_approval_processed_amount	partial_approval_processed_currency	partial_approval_processed_amount_in_usd	website_id	browser_user_agent	ip_country	processor_id	processor_name	risk_email_id	is_currency_converted	email_seniority_start_date	email_payment_attempts	final_fraud_decision_id	external_token_eci	risk_threed_eci	threed_eci	cvv_code	provider_response_code	issuer_card_program_id	scenario_id	previous_id	next_id	step	reprocess_3d_reason	data_only_authentication_result	is_cascaded_after_data_only_authentication	next_action	authentication_method	cavv_verification_code	channel	authentication_request	authentication_response	cc_hash	exp_date	message_version_3d	cc_seniority_start_date	mc_scheme_token_used	is_sale_3d_auth_3d	manage_3d_decision_auth_3d	init_status	auth_3d_status	sale_status	auth_status	settle_status	verify_auth_3d_status	is_successful_challenge	is_successful_exemption	is_successful_frictionless	is_successful_authentication	is_approved	is_declined	inserted_at	stored_credentials_mode	avs_code	is_3d	credit_type_id	subscription_step	scheme_token_fetching_result	browser_screen_height	browser_screen_width	filter_reason_id	reason_code	reason	request_timestamp_service	token_unique_reference_service	response_timestamp_service	api_type_service	request_timestamp_fetching	token_unique_reference_fetching	response_timestamp_fetching	api_type_fetching	is_cryptogram_fetching_skipped	is_external_scheme_token	three_ds_server_trans_id	gateway_id	cc_request_type_id	upo_id	IsCardReplaced	IsVdcuFeeApplied	AftType	secondarycccid	transaction_duration	authorization_req_duration	FirstInstallment	PeriodicalInstallment	numberOfInstallments	InstallmentProgram	InstallmentFundingType	first_installment_usd	periodical_installment_usd	ApplicableScenarios	cascading_ab_test_experimant_name', '\t') AS column_array
)
SELECT 
  'DATABRICKS SILVER TABLE ANALYSIS' AS analysis_type,
  ARRAY_SIZE(column_array) AS total_columns,
  column_array
FROM databricks_columns;
